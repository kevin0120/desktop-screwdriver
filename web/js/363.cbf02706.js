"use strict";(self["webpackChunkleetx_web"]=self["webpackChunkleetx_web"]||[]).push([[363],{39496:function(t,e,s){s.d(e,{QO:function(){return o},Y6:function(){return u},cx:function(){return n},fm:function(){return d},j$:function(){return r},me:function(){return l},oN:function(){return a}});var i=s(11586);function a(){return(0,i.Z)({url:"dev/calibrate/sensor/kb",method:"get"})}function l(){return(0,i.Z)({url:"dev/calibrate/sensor/result",method:"get"})}function n(t){return(0,i.Z)({url:"dev/calibrate/sensor/set",method:"post",data:t})}function r(){return(0,i.Z)({url:"dev/calibrate/fac",method:"get"})}function u(){return(0,i.Z)({url:"dev/calibrate/pro",method:"get"})}function o(){return(0,i.Z)({url:"dev/calibrate/exit",method:"get"})}function d(){return(0,i.Z)({url:"dev/calibrate/enable",method:"get"})}},89555:function(t,e,s){s.d(e,{Z:function(){return g}});var i=s(66252),a=s(3577),l=s(49963);const n=["id"],r={class:"val-box"},u={class:"num"};function o(t,e,s,o,d,h){return(0,i.wg)(),(0,i.iD)("div",{class:(0,a.C_)({"counter-box":!0,"valid-text":!s.textValid}),id:d.cid},[(0,i._)("div",{class:"sub-box",onClick:e[0]||(e[0]=(...t)=>h.subNum&&h.subNum(...t))},[(0,i._)("span",{class:(0,a.C_)(["sub-btn",{forbit:d.num==d.min}])},"-",2)]),(0,i._)("div",r,[(0,i._)("span",u,(0,a.zw)(d.num),1)]),(0,i._)("div",{class:"add-box",onClick:e[1]||(e[1]=(...t)=>h.addNum&&h.addNum(...t))},[(0,i._)("span",{class:(0,a.C_)(["add-btn",{forbit:d.num==d.max}])},"+",2)]),(0,i.wy)((0,i._)("span",{class:"valid-reason"},(0,a.zw)(s.validReason),513),[[l.F8,!s.textValid]])],10,n)}const d={data(){return{num:0,cid:Math.random(),max:0,min:0}},props:{cnum:{type:Number,default:0},_width:{type:String,default:"7.5rem"},_bWidth:{type:String,default:"1.7625rem"},_height:{type:String,default:"3.1431rem"},_ftszie:{type:String,default:"1.5rem"},_min:{type:Number,default:-9999},_max:{type:Number,default:9999},_value:{type:Number,default:1},textValid:{type:Boolean,default:!0},validReason:{type:String,default:"数据不合法"}},methods:{subNum(){this.num=Math.floor(this.num>this._min?this.num-this._value:this._min),this.$emit("update",this.num)},addNum(){Math.floor(this.num=this.num<this._max?this.num+this._value:this._max),this.$emit("update",this.num)},initNum(){this.max=this._max,this.min=this._min,this.num=Math.floor(this.cnum>=this.min&&this.cnum<=this.max?this.cnum:this.min),this.$emit("update",this.num)}},watch:{cnum:{handler:function(){this.initNum()}},_max:{deep:!0,handler:function(){this.initNum()}},_min:{deep:!0,handler:function(){this.initNum()}}},created(){this.initNum()}},h=()=>{(0,l.sj)((t=>({"0c347b10":t._height,"29ed0e55":t._width,"1157763c":t._ftszie})))},c=d.setup;d.setup=c?(t,e)=>(h(),c(t,e)):h;var m=d,b=s(83744);const p=(0,b.Z)(m,[["render",o],["__scopeId","data-v-a7278d4e"]]);var g=p},86363:function(t,e,s){s.r(e),s.d(e,{default:function(){return F}});var i=s(66252),a=s(3577);const l=t=>((0,i.dD)("data-v-640dbf98"),t=t(),(0,i.Cn)(),t),n={class:"tech-dmrct"},r={class:"select-program-line"},u={class:"select-program-text"},o={class:"is-calibration"},d={class:"serial-line"},h={class:"serial-text"},c={class:"device-text"},m={class:"device-input"},b={class:"demarcate-val"},p={class:"mask-box"},g=l((()=>(0,i._)("td",{class:"delBox"},null,-1))),f={class:"table-box"},_={class:"demarcate-table"},v={class:"delBox"},w={class:"cacl-line"},x={class:"calc-res"};function C(t,e,s,l,C,$){const k=(0,i.up)("NewSelect"),V=(0,i.up)("LeetxSwitch"),y=(0,i.up)("Counter"),N=(0,i.up)("InputVal"),z=(0,i.up)("LeetxButton");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",r,[(0,i._)("span",u,(0,a.zw)(t.$t("dbgdmrct.programselect")),1),(0,i.Wm)(k,{isScroll:!0,module:C.module,isAllowChng:!$.isBusy,width:15,height:2.4,realVal:$.defaultPset,options:C.pros,isReturnKey:!1,class:"select",onValChng:e[0]||(e[0]=t=>$.valChng(t))},null,8,["module","isAllowChng","height","realVal","options"])]),(0,i._)("div",null,[(0,i._)("span",o,(0,a.zw)(t.$t("dbgdmrct.isCalibration")),1),(0,i.Wm)(V,{module:C.module,value:C.isCalibrated,activeVal:!0,staticVal:!1,height:2,class:"is-calibration-btn",modelValue:C.isCalibrated,"onUpdate:modelValue":e[1]||(e[1]=t=>C.isCalibrated=t)},null,8,["module","value","modelValue"])]),(0,i._)("div",d,[(0,i._)("span",h,(0,a.zw)(t.$t("dbgdmrct.serialnumber")),1),(0,i.Wm)(y,{cnum:C.nthGroup,_min:0,_max:$.maxGroup,_height:"2.5rem",onUpdate:e[2]||(e[2]=t=>C.nthGroup=t),class:"serial-counter"},null,8,["cnum","_max"]),(0,i._)("span",c,(0,a.zw)(t.$t("dbgdmrct.torquevalue")),1),(0,i._)("span",m,(0,a.zw)(C.devVal),1),(0,i._)("span",b,(0,a.zw)(t.$t("dbgdmrct.referencevalue")),1),(0,i.Wm)(N,{module:C.module,sensorValue:C.calibrationVal,editable:C.editable,class:"demarcate-input",width:"12.5vw",height:"3.125vh",onUpdateData:e[3]||(e[3]=t=>$.updateData(t))},null,8,["module","sensorValue","editable"]),(0,i.Wm)(z,{class:"add",module:C.module,bgcColor:"transparent",width:"2rem",height:"2rem",borderRadius:"0",useIcon:!0,icon:"AddDmrct",iconSize:"2.5rem",onClick:$.addToArr},null,8,["module","onClick"]),(0,i.Wm)(z,{module:C.module,class:"del-icon",bgcColor:"transparent",width:"2rem",height:"2rem",useIcon:!0,icon:"DeleteAll",iconSize:"2.5rem",onClick:$.delFromArrAll},null,8,["module","onClick"])]),(0,i._)("div",p,[(0,i._)("tr",null,[(0,i._)("td",null,(0,a.zw)(t.$t("dbgdmrct.serialnumber")),1),(0,i._)("td",null,(0,a.zw)(t.$t("dbgdmrct.torquevalue")),1),(0,i._)("td",null,(0,a.zw)(t.$t("dbgdmrct.referencevalue")),1),g]),(0,i._)("div",f,[(0,i._)("table",_,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(C.inputs.length,(t=>((0,i.wg)(),(0,i.iD)("tr",{key:t},[(0,i._)("td",null,(0,a.zw)(t),1),(0,i._)("td",null,(0,a.zw)(C.devs[t-1]),1),(0,i._)("td",null,(0,a.zw)(C.inputs[t-1]),1),(0,i._)("td",v,[(0,i.Wm)(z,{class:"delOne",module:C.module,bgcColor:"transparent",width:"2rem",height:"2rem",borderRadius:"0",useIcon:!0,icon:"DelDmrct",iconSize:"2rem",onClick:e=>$.delFromArr(t)},null,8,["module","onClick"])])])))),128))])])]),(0,i._)("div",w,[(0,i.Wm)(z,{module:C.module,class:"btn",textColor:"#fff",borderRadius:"4px",bgcColor:"#00c155",width:"17.25vw",height:"3.9063vh",fontSize:"1.625rem",fontFamily:"--SHSC-M",text:t.$t("dbgdmrct.calculate"),onClick:$.calculate},null,8,["module","text","onClick"]),(0,i._)("span",x,(0,a.zw)(t.$t("dbgdmrct.sensitivity"))+"："+(0,a.zw)(C.k),1)]),(0,i.Wm)(z,{class:"confirm-box",module:C.module,textColor:"#fff",borderRadius:"4px",bgcColor:"#00c155",width:"30.125rem",height:"3.75rem",fontSize:"2.25rem",fontFamily:"--SHSC-B",text:t.$t("dbgdmrct.save"),onClick:$.submitCalibrateData},null,8,["module","text","onClick"])])}var $=s(31955),k=s(22213),V=s(89555),y=s(92165),N=s(39496),z=s(84965),S=s(74125),Z=s(10335),D=s(32015),L={components:{NewSelect:y.Z,LeetxButton:Z.Z,Counter:V.Z,InputVal:k.Z},data(){return{calibrateData:{},gain:0,offset:0,devs:[],inputs:[],files:[],pros:{},res:{ret_sensor:.001,ret_pos:.002},nthGroup:0,k:0,b:0,module:"CALIBRATION",times:0,devVal:0,calibrationVal:0,editable:!1,isCalibrated:!1,tableList:[]}},methods:{getRes(){(0,N.oN)().then((t=>{0==t.status?(this.k=t.data.calib_k,this.b=t.data.calib_offset):z.c.warning(["获取标定数据失败"])})).catch((()=>{z.c.warning(["获取标定数据失败"])}))},enterProPage(){(0,N.Y6)().then((t=>{0!=t.status?z.c.warning(["进入工艺标定失败"]):(0,N.fm)().then((t=>{this.isCalibrated=t.data.calibrate_enable})).catch((()=>{z.c.warning(["启用工艺标定失败"])}))})).catch((()=>{z.c.warning(["进入工艺标定失败"])}))},leaveProPage(){(0,N.QO)().then((t=>{0!=t.status&&z.c.warning(["退出标定失败"])})).catch((()=>{z.c.warning(["退出标定失败"])}))},getAllProfiles(){(0,S.Lm)().then((t=>{if(0==t.status){this.files=t.data,this.pfList=this.files.sort(this.sortBy("pset"));for(let t=0;t<this.files.length;t++)this.pros[`${this.files[t].pset} [${this.files[t].name}]`]=this.files[t].pset}}))},valChng(t){if(1==this.$store.state.g_status.psetsrc)void 0!=t&&(0,S.TU)(t).then((()=>{z.c.success([this.$t("promsg.activate_suc")]),(0,N.fm)().then((t=>{this.isCalibrated=t.data.calibrate_enable,0!=t.status&&z.c.warning(["启用工艺标定失败"])})).catch((()=>{z.c.warning(["启用工艺标定失败"])}))})).catch((()=>{z.c.error([this.$t("promsg.activate_fail")])}));else{let t=this.$t("promsg.msgOne"),e=this.$t("promsg.msgTwo");z.c.warning([t,e])}},clbck(){z.c.warning([this.$t("promsg.run_status"),this.$t("promsg.nactivate_file")])},sortBy(t){return function(e,s){return e[t]-s[t]}},updateData(t){this.calibrationVal=t.sensorValue,$.Z.set("techData",this.calibrationVal)},addToArr(){let t=parseFloat(this.devVal.toFixed(3)),e=parseFloat(this.calibrationVal.toFixed(3));if("0"==t)return z.c.warning(["扭矩值不能为0"]);this.devs.splice(this.nthGroup,0,t),this.inputs.splice(this.nthGroup,0,e),this.nthGroup+=1;let s={dev:t,input:e,nthGroup:this.nthGroup};this.tableList.push(s);let i=JSON.stringify(this.tableList);$.Z.set("tableList",i)},delFromArr(t){if(0!=this.nthGroup){this.devs.splice(t-1,1),this.inputs.splice(t-1,1),this.nthGroup=this.nthGroup>this.inputs.length-1?this.inputs.length:this.nthGroup,this.tableList=[];for(let t=0;t<this.nthGroup;t++){let e={dev:this.devs[t],input:this.inputs[t],nthGroup:t+1};this.tableList.push(e);let s=JSON.stringify(this.tableList);$.Z.set("tableList",s)}}},delFromArrAll(){if(0==this.devs.length&&0==this.inputs.length)return;let t=this.$t("dbgdmrct.deleteConfigurate"),e=this.$t("dbgdmrct.yes"),s=this.$t("dbgdmrct.no"),i=this.$t("dbgdmrct.deleteAll");(0,D.Z)({title:t,confirmText:e,cancelText:s,msg:i}).then((()=>{this.devs=[],this.inputs=[],this.nthGroup=0})),$.Z.remove("tableList")},calculate(){(0,N.oN)().then((t=>{if(0==t.status){if(this.k=t.data.calib_k,this.b=t.data.calib_offset,this.devs.length!=this.inputs.length||0==this.devs.length)return;let e=0;for(let t=0;t<this.inputs.length;t++){let s=this.inputs[t]-this.b,i=this.devs[t]-this.b,a=s/i;e+=a/this.inputs.length}this.k=parseFloat(e).toFixed(5)}})).catch((()=>{z.c.error(["读取截距失败！"])}))},submitCalibrateData(){const t=this.k,e=this.b,s=this.isCalibrated;(0,N.cx)({calib_k:t,calib_offset:e,calibrate_enable:s}).then((t=>{if(0==t.status){let t=this.$t("global.success");z.c.success([t])}else{let t=this.$t("global.err");z.c.error([t])}})).catch((()=>{let t=this.$t("global.err");z.c.error([t])}))},getDevVal(){(0,N.me)().then((t=>{if(this.devVal=parseFloat(t.data.inner_maxval.toFixed(3)),t.data.has_ext)this.calibrationVal=t.data.ext_maxval;else{this.editable=!0;const t=$.Z.get("techData");this.calibrationVal=parseInt(t);const e=$.Z.get("tableList");void 0!==e&&(this.tableList=JSON.parse(e),this.tableList.forEach((t=>{this.devs.push(t.dev),this.inputs.push(t.input)})),this.nthGroup=this.tableList.length)}}))}},mounted(){this.enable&&this.enterProPage(),this.getDevVal()},unmounted(){this.enable&&this.leaveProPage()},created(){this.getAllProfiles()},computed:{isBusy(){return this.$store.state.g_status.busy},runOk(){return this.$store.state.g_status["rok"]},torque(){return parseFloat(this.res.ret_sensor.toFixed(3))},maxGroup(){return this.inputs.length},defaultPset(){return this.$store.state.g_status["pset"]},enable(){return this.module in this.$store.state.f_status.permissions&&4==this.$store.state.f_status.permissions[this.module]}},watch:{runOk:{handler(){this.runOk&&this.enable&&this.getDevVal()}}}},G=s(83744);const A=(0,G.Z)(L,[["render",C],["__scopeId","data-v-640dbf98"]]);var F=A}}]);
//# sourceMappingURL=363.cbf02706.js.map