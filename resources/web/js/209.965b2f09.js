"use strict";(self["webpackChunkleetx_web"]=self["webpackChunkleetx_web"]||[]).push([[209],{3185:function(e,t,s){s.d(t,{I0:function(){return a},Lk:function(){return n},YL:function(){return l},i:function(){return o},v3:function(){return c}});var i=s(11586);function o(e){return(0,i.Z)({url:"pf/jobmod",method:"post",data:e})}function l(e){return(0,i.Z)({url:`pf/cur/job?id=${e}`,method:"get"})}function n(){return(0,i.Z)({url:"pf/cur/joblst",method:"get"})}function a(e){return(0,i.Z)({url:"pf/jobdel",method:"post",params:e})}function c(e){return(0,i.Z)({url:`pf/cur/jobsel?job=${e}`,method:"get"})}},59317:function(e,t,s){function i(e){let t;if(e instanceof Array){t=[];for(let s=0;s<e.length;s++)t[s]=i(e[s])}else if(e instanceof Object){t={};for(let s of Object.keys(e))t[s]=i(e[s])}else t=e;return t}function o(e,t,s=!1){let i=!0;if(e instanceof Array&&t instanceof Array&&t.length==e.length){for(let l=0;l<e.length;l++)if(i=i&&o(e[l],t[l],s),!i)break}else if(!(e instanceof Object&&t instanceof Object)||e instanceof Array||t instanceof Array)e instanceof Object||t instanceof Object?i=!1:(i=!0,s&&(i=e===t));else for(let l in e){if(!(l in t)){i=!1;break}if(i=i&&o(e[l],t[l],s),!i)break}return i}function l(e,t,s=!1){return s?JSON.stringify(e)===JSON.stringify(t):o(e,t)}s.d(t,{IK:function(){return l},p$:function(){return i}})},67209:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var i=s(66252),o=s(3577);const l=e=>((0,i.dD)("data-v-0f8beb6a"),e=e(),(0,i.Cn)(),e),n={class:"tech-box"},a={class:"tech-basemsg-line"},c={class:"job-name-title"},r=l((()=>(0,i._)("div",{class:"job-options-box_line_top1"},null,-1))),u={class:"tech-basemsg-line"},h=l((()=>(0,i._)("span",{class:"tech-num"},"Job名称",-1))),d=l((()=>(0,i._)("span",{class:"tech-num-2"},"NG后重复次数",-1))),m=l((()=>(0,i._)("div",{class:"job-options-box_line_top1"},null,-1))),p={class:"tech-basemsg-line"},_=l((()=>(0,i._)("div",{class:"job-options-box_line_top1"},null,-1))),f={class:"operate-line"},b=l((()=>(0,i._)("br",null,null,-1))),v=l((()=>(0,i._)("span",null,"并行添加",-1))),g=l((()=>(0,i._)("div",null,[(0,i._)("span",{class:"line"})],-1))),P=l((()=>(0,i._)("br",null,null,-1))),I=l((()=>(0,i._)("span",null,"串行添加",-1))),J=l((()=>(0,i._)("div",null,[(0,i._)("span",{class:"line"})],-1))),S=l((()=>(0,i._)("br",null,null,-1))),x=l((()=>(0,i._)("span",null,"删除",-1))),j=l((()=>(0,i._)("div",null,[(0,i._)("span",{class:"line"})],-1))),w=l((()=>(0,i._)("br",null,null,-1))),C=l((()=>(0,i._)("span",null,"保存",-1))),V=l((()=>(0,i._)("div",{class:"job-options-box_line_top1"},null,-1))),k={key:0,class:"job-options-box"},N={key:0,class:"job-options-box_line1"},y=l((()=>(0,i._)("div",{class:"job-options-box_f"},"&",-1))),A=l((()=>(0,i._)("div",{class:"job-options-box_line2"},null,-1))),L=["onClick"],O={class:"pf-static-num"},D={class:"file-name"},R={key:1,class:"pro-step-data"},W={class:"tech-basemsg-line"},F=l((()=>(0,i._)("span",{class:"tech-num"},"Pset",-1))),M={class:"tech-basemsg-line"},q=l((()=>(0,i._)("span",{class:"tech-num"},"任务数量",-1))),B={class:"tech-basemsg-line"},$=l((()=>(0,i._)("span",{class:"tech-num"},"计数方式",-1))),z=l((()=>(0,i._)("span",{class:"tech-num-2"},"强制任务状态",-1))),E={class:"tech-basemsg-line"},Z=l((()=>(0,i._)("span",{class:"tech-num"},"反松减计数",-1))),G=l((()=>(0,i._)("span",{class:"tech-num-2"},"反松模式",-1)));function K(e,t,s,l,K,T){const Y=(0,i.up)("InputText"),U=(0,i.up)("InputVal"),H=(0,i.up)("LeetxSwitch"),Q=(0,i.up)("FormItem"),X=(0,i.up)("svg-loader"),ee=(0,i.up)("NewSelect");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",a,[(0,i._)("span",c,"JOB"+(0,o.zw)(K.JobId.toString().padStart(3,"0"))+"编辑",1)]),r,(0,i._)("div",u,[h,(0,i.Wm)(Y,{module:K.module,class:"tech-input-1",width:"20vw",disabled:!0,text:K.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>K.Name=e.text),textValid:""==T.nameReason,validReason:T.nameReason},null,8,["module","text","textValid","validReason"]),d,(0,i.Wm)(U,{maxNum:9999,module:K.module,sensorValue:K.MaxNGCount,width:"12rem",class:"tech-input","onUpdate:sensorValue":t[1]||(t[1]=e=>K.MaxNGCount=e)},null,8,["module","sensorValue"])]),m,(0,i._)("div",p,[((0,i.wg)(),(0,i.j4)(Q,{key:0,label:"Pset自动选择",labelWidth:"5rem",outClass:"repeat-run",leftDis:"5.375vw",class:"cyc-box"},{default:(0,i.w5)((()=>[(0,i.Wm)(H,{module:K.module,value:K.AutoSelPset,activeVal:!0,staticVal:!1,height:2,class:"repeat-btn",onSentVal:t[2]||(t[2]=e=>K.AutoSelPset=e)},null,8,["module","value"])])),_:1})),(0,i.Wm)(Q,{label:"输出循环",labelWidth:"5rem",outClass:"repeat-run",leftDis:"5.375vw",class:"cyc-box-1"},{default:(0,i.w5)((()=>[(0,i.Wm)(H,{module:K.module,value:K.Reused,activeVal:!0,staticVal:!1,height:2,class:"repeat-btn-1",onSentVal:t[3]||(t[3]=e=>K.Reused=e)},null,8,["module","value"])])),_:1})]),_,(0,i._)("div",f,[(0,i._)("div",{class:"operate-box-stroke",onClick:t[4]||(t[4]=(...e)=>T.addParallelPf&&T.addParallelPf(...e))},[(0,i.Wm)(X,{class:"pfIcon",icon:"Addparallel",size:"2.5rem"}),b,v]),g,(0,i._)("div",{class:"operate-box-stroke",onClick:t[5]||(t[5]=(...e)=>T.addSerialPf&&T.addSerialPf(...e))},[(0,i.Wm)(X,{class:"pfIcon",icon:"Addserial",size:"2.5rem"}),P,I]),J,(0,i._)("div",{class:"operate-box",onClick:t[6]||(t[6]=(...e)=>T.deletePf&&T.deletePf(...e))},[(0,i.Wm)(X,{class:"pfIcon",icon:"EditTwo",size:"2.5rem"}),S,x]),j,(0,i._)("div",{class:"operate-box",onClick:t[7]||(t[7]=(...e)=>T.confirm&&T.confirm(...e))},[(0,i.Wm)(X,{class:"pfIcon",icon:"RightOne",size:"2.5rem"}),w,C])]),V,0!=K.JobItems.length?((0,i.wg)(),(0,i.iD)("div",k,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(K.JobItems,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:"job-options-box_1"},[t?((0,i.wg)(),(0,i.iD)("div",N)):(0,i.kq)("",!0),y,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{key:s,class:"job-options-box_2"},[A,(0,i._)("div",{class:(0,o.C_)({"job-options-box_4":!0,"job-options-box_4_active":K.active_item_i==t&&K.active_item_j==s}),onClick:e=>T.selectFile(t,s)},[(0,i.Wm)(X,{class:(0,o.C_)({"file-static-icon":!0}),icon:K.active_item_i==t&&K.active_item_j==s?"ActivePf":"StaticPf"},null,8,["icon"]),(0,i._)("span",O,(0,o.zw)(e.Pset),1),(0,i._)("span",D,"批次数:"+(0,o.zw)(e.BatchSize),1)],10,L)])))),128))])))),128))])):(0,i.kq)("",!0),-1!=K.curJobId?((0,i.wg)(),(0,i.iD)("div",R,[(0,i._)("div",W,[F,(0,i.Wm)(ee,{isScroll:!0,bottom:!0,module:K.module,width:36,realVal:T.currentPset.Pset,isAllowChng:!0,class:"tech-input-1",options:K.profileOptionNameLst,onValChng:t[8]||(t[8]=e=>T.setParams("Pset",e))},null,8,["module","realVal","options"])]),(0,i._)("div",M,[q,(0,i.Wm)(U,{maxNum:9999,module:K.module,sensorValue:T.currentPset.BatchSize,width:"12rem",class:"tech-input-1",onUpdateData:t[9]||(t[9]=e=>T.setParams("BatchSize",e.sensorValue))},null,8,["module","sensorValue"])]),(0,i._)("div",B,[$,(0,i.Wm)(ee,{bottom:!0,module:K.module,width:12,realVal:T.currentPset.OnlyCntOK,isAllowChng:!0,class:"tech-input-1",options:{"总是计数":0,"合格时才计数":1},onValChng:t[10]||(t[10]=e=>T.setParams("OnlyCntOK",e))},null,8,["module","realVal"]),z,(0,i.Wm)(ee,{bottom:!0,module:K.module,width:12,realVal:T.currentPset.ForceBatchStatus,isAllowChng:!0,class:"tech-input",options:{"批次不合格":0,"批次合格":1},onValChng:t[11]||(t[11]=e=>T.setParams("ForceBatchStatus",e))},null,8,["module","realVal"])]),(0,i._)("div",E,[Z,(0,i.Wm)(ee,{bottom:!0,module:K.module,width:12,realVal:T.currentPset.DecLoosening,isAllowChng:!0,class:"tech-input-1",options:{"永远不减计数":0,"反松时减计数":1,"反松OK后减计数":2},onValChng:t[12]||(t[12]=e=>T.setParams("DecLoosening",e))},null,8,["module","realVal"]),G,(0,i.Wm)(ee,{bottom:!0,module:K.module,width:12,realVal:T.currentPset.LooseningMode,isAllowChng:!0,class:"tech-input",options:{"永远不反松":0,"始终反松":1,"不合格时反松":2},onValChng:t[13]||(t[13]=e=>T.setParams("LooseningMode",e))},null,8,["module","realVal"])])])):(0,i.kq)("",!0)])}var T=s(59317),Y=s(22805),U=s(77671),H=s(22213),Q=s(92165),X=s(84965),ee=s(3185),te=s(74125),se=s(49963);const ie={components:{NewSelect:Q.Z,InputText:U.Z,InputVal:H.Z},data(){return{module:"PROFILE",seqItems:[],activeSeqIndex:-1,addSeqIndex:-1,sel_seq_type:"",profile:{},profile_json:"",global_paras_json:"",profile_name:"...",validPset:!0,curJobId:-1,need_check_edit:!1,delPsetNum:0,profileNameLst:[],defaultPset:{Pset:0,RetriesLimit:!0,Retries:1,BatchSizeLimit:!0,BatchSize:10,LooseningMode:0,OnlyCntOK:1,ForceBatchStatus:0,DecLoosening:0},profileOptionNameLst:{"无":0},active_item_i:0,active_item_j:0,Name:"job1",JobId:0,Descr:"",Ver:"1.0.0",Mode:1,Reused:!0,JobSelSource:0,AutoSelPset:!1,MaxNGCount:10,JobItems:[]}},beforeRouteLeave(e,t,s){s()},methods:{selectFile(e,t){this.active_item_i=e,this.active_item_j=t},setParams(e,t){this.JobItems[this.active_item_i][this.active_item_j][e]=t},setboolParams(e,t){this.JobItems[this.active_item_i][this.active_item_j][e]=t},addParallelPf(){this.JobItems[this.active_item_i].splice(this.active_item_j+1,0,(0,T.p$)(this.defaultPset)),this.active_item_j++},addSerialPf(){this.JobItems[this.active_item_i+1]=this.JobItems[this.active_item_i+1]?this.JobItems[this.active_item_i+1]:[],this.JobItems[this.active_item_i+1].unshift((0,T.p$)(this.defaultPset)),this.active_item_i++,this.active_item_j=0},deletePf(){this.JobItems[this.active_item_i].splice(this.active_item_j,1),this.active_item_j=0,0==this.JobItems[this.active_item_i].length&&(this.JobItems.splice(this.active_item_i,1),this.active_item_i=0),0==this.JobItems.length&&(this.JobItems=[[(0,T.p$)(this.defaultPset)]],this.profile.JobItems=this.JobItems)},confirm(){this.profile.Name=this.Name,this.profile.JobId=this.JobId,this.profile.Descr=this.Descr,this.profile.Ver=this.Ver,this.profile.Mode=this.Mode,this.profile.Reused=this.Reused,this.profile.JobSelSource=this.JobSelSource,this.profile.AutoSelPset=this.AutoSelPset,this.profile.MaxNGCount=this.MaxNGCount,this.sendFileToServerApi(this.profile,this.saveSuccess)},resetData(){this.getPfList(),this.closeSeqAddingBox(),this.sel_seq_type="",this.curJobId=-1,this.profile_name="...",this.seqItems=[],this.need_check_edit=!1},closeSeqAddingBox(){this.addSeqIndex=-1},backStaticBox(){this.activeBox=-1},sendFileToServerApi(e,t){if(!this.enabledEdit)return X.c.warning(["该文件处于运行状态","不允许修改"]);(0,ee.i)({Profile:e}).then((e=>{this.need_check_edit=!1,t&&t(e)})).catch((e=>{console.log("pfModJobApi profile error ",e),X.c.error(["工艺文件保存失败"])}))},getFileContentByJobApi(e,t,s){(0,ee.YL)(e).then((e=>{t&&t(e)})).catch((e=>{console.log("getFileContent profile error ",e),s&&s(e)}))},getCurJobProfile(e){e&&e>0&&this.getFileContentByJobApi(e,(t=>{if(0===t.status){let s=t.data.Profile;this.profile=s,this.setFileContent(s),this.curJobId=e,this.need_check_edit=!0}else this.curJobId=-1,this.need_check_edit=!1,X.c.warning(["获取文件失败"])}),(()=>{this.curJobId=-1,this.need_check_edit=!1,X.c.warning(["获取文件失败"])}))},setFileContent(e){this.profile_name=e.Name,this.profile=e,this.Name=this.profile.Name,this.Descr=this.profile.Descr,this.Ver=this.profile.Ver,this.Mode=this.profile.Mode,this.Reused=this.profile.Reused,this.JobSelSource=this.profile.JobSelSource,this.AutoSelPset=this.profile.AutoSelPset,this.MaxNGCount=this.profile.MaxNGCount,this.JobItems=this.profile.JobItems,this.profile_json=JSON.stringify(this.JobItems)},initEmptyProfile(){this.profile=(0,Y.mK)(2),this.setFileContent(this.profile)},excuteDefaultAction(){this.JobId=parseInt(this.$route.query.job),this.curJobId=this.JobId,this.curJobId>0&&this.getCurJobProfile(this.curJobId)},getPfList(e){(0,te.Lm)().then((t=>{9127!=t.status&&0==t.status&&(this.profileNameLst=[],t.data.forEach((e=>{this.profileOptionNameLst[e.name]=e.pset})),e&&e())})).catch((()=>{}))},saveSuccess(e){0==e.status?(this.profile_json=JSON.stringify(this.seqItems),X.c.success(["保存成功"])):9131==e.status?X.c.warning(["文件没有发生变动"]):9125==e.status?X.c.warning(["文件不存在"]):9128==e.status?X.c.warning(["文件版本号不一致"]):9129==e.status?X.c.warning(["下位机执行修改文件失败"]):X.c.error([`保存失败,代码[${e.status}]`])},checkDelPfPset(){this.$bus.on("delPset",(e=>{this.delPsetNum=e.pset,this.profile}))}},computed:{currentPset(){return this.JobItems[this.active_item_i][this.active_item_j]},currentPsetlist(){return this.JobItems[this.active_item_i][this.active_item_j]},enabledEdit(){return 0==(this.curJobId==this.$store.state.g_status.pset&&this.$store.state.g_status.busy)},nameReason(){return-1==this.curJobId?-1:0==this.profile_name.length?"文件名不能为空":this.profile_name&&this.profileNameLst.length>0&&-1!=this.profileNameLst.indexOf(this.profile_name)?"文件名重复":""},enabled(){return"PROFILE"in this.$store.state.f_status.permissions&&4==this.$store.state.f_status.permissions["PROFILE"]},pointerEvent(){return this.enabled?"auto":"none"},opacity(){return this.enabled?1:.5}},created(){this.getPfList(),this.initEmptyProfile(),this.checkDelPfPset()},watch:{"$route.query.job":{immediate:!0,handler:function(){this.excuteDefaultAction()}}}},oe=()=>{(0,se.sj)((e=>({"6a33390a":e.pointerEvent,"48fb7c2d":e.opacity})))},le=ie.setup;ie.setup=le?(e,t)=>(oe(),le(e,t)):oe;var ne=ie,ae=s(83744);const ce=(0,ae.Z)(ne,[["render",K],["__scopeId","data-v-0f8beb6a"]]);var re=ce}}]);
//# sourceMappingURL=209.965b2f09.js.map