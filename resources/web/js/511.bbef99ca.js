"use strict";(self["webpackChunkleetx_web"]=self["webpackChunkleetx_web"]||[]).push([[511],{3185:function(t,e,i){i.d(e,{I0:function(){return r},Lk:function(){return n},YL:function(){return a},i:function(){return o},v3:function(){return l}});var s=i(11586);function o(t){return(0,s.Z)({url:"pf/jobmod",method:"post",data:t})}function a(t){return(0,s.Z)({url:`pf/cur/job?id=${t}`,method:"get"})}function n(){return(0,s.Z)({url:"pf/cur/joblst",method:"get"})}function r(t){return(0,s.Z)({url:"pf/jobdel",method:"post",params:t})}function l(t){return(0,s.Z)({url:`pf/cur/jobsel?job=${t}`,method:"get"})}},89555:function(t,e,i){i.d(e,{Z:function(){return b}});var s=i(66252),o=i(3577),a=i(49963);const n=["id"],r={class:"val-box"},l={class:"num"};function c(t,e,i,c,u,d){return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)({"counter-box":!0,"valid-text":!i.textValid}),id:u.cid},[(0,s._)("div",{class:"sub-box",onClick:e[0]||(e[0]=(...t)=>d.subNum&&d.subNum(...t))},[(0,s._)("span",{class:(0,o.C_)(["sub-btn",{forbit:u.num==u.min}])},"-",2)]),(0,s._)("div",r,[(0,s._)("span",l,(0,o.zw)(u.num),1)]),(0,s._)("div",{class:"add-box",onClick:e[1]||(e[1]=(...t)=>d.addNum&&d.addNum(...t))},[(0,s._)("span",{class:(0,o.C_)(["add-btn",{forbit:u.num==u.max}])},"+",2)]),(0,s.wy)((0,s._)("span",{class:"valid-reason"},(0,o.zw)(i.validReason),513),[[a.F8,!i.textValid]])],10,n)}const u={data(){return{num:0,cid:Math.random(),max:0,min:0}},props:{cnum:{type:Number,default:0},_width:{type:String,default:"7.5rem"},_bWidth:{type:String,default:"1.7625rem"},_height:{type:String,default:"3.1431rem"},_ftszie:{type:String,default:"1.5rem"},_min:{type:Number,default:-9999},_max:{type:Number,default:9999},_value:{type:Number,default:1},textValid:{type:Boolean,default:!0},validReason:{type:String,default:"数据不合法"}},methods:{subNum(){this.num=Math.floor(this.num>this._min?this.num-this._value:this._min),this.$emit("update",this.num)},addNum(){Math.floor(this.num=this.num<this._max?this.num+this._value:this._max),this.$emit("update",this.num)},initNum(){this.max=this._max,this.min=this._min,this.num=Math.floor(this.cnum>=this.min&&this.cnum<=this.max?this.cnum:this.min),this.$emit("update",this.num)}},watch:{cnum:{handler:function(){this.initNum()}},_max:{deep:!0,handler:function(){this.initNum()}},_min:{deep:!0,handler:function(){this.initNum()}}},created(){this.initNum()}},d=()=>{(0,a.sj)((t=>({"0c347b10":t._height,"29ed0e55":t._width,"1157763c":t._ftszie})))},h=u.setup;u.setup=h?(t,e)=>(d(),h(t,e)):d;var m=u,p=i(83744);const f=(0,p.Z)(m,[["render",c],["__scopeId","data-v-a7278d4e"]]);var b=f},55511:function(t,e,i){i.r(e),i.d(e,{default:function(){return Q}});var s=i(66252),o=i(3577);const a=t=>((0,s.dD)("data-v-86519fee"),t=t(),(0,s.Cn)(),t),n={class:"files-box"},r={class:"operate-line"},l=a((()=>(0,s._)("br",null,null,-1))),c=a((()=>(0,s._)("div",null,[(0,s._)("span",{class:"line"})],-1))),u=a((()=>(0,s._)("br",null,null,-1))),d=a((()=>(0,s._)("div",null,[(0,s._)("span",{class:"line"})],-1))),h=a((()=>(0,s._)("br",null,null,-1))),m=a((()=>(0,s._)("div",null,[(0,s._)("span",{class:"line"})],-1))),p=a((()=>(0,s._)("br",null,null,-1))),f={class:"items-box"},b=["onClick"],_={class:"file-name"},v={class:"add-box"};function w(t,e,i,a,w,g){const x=(0,s.up)("svg-loader"),$=(0,s.up)("LeetxButton");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",r,[(0,s._)("div",{class:"operate-box add-pf",onClick:e[0]||(e[0]=(...t)=>g.addPf&&g.addPf(...t))},[(0,s.Wm)(x,{class:"pfIcon",icon:"AddTwo",size:"2.5rem"}),l,(0,s._)("span",null,(0,o.zw)(t.$t("profile.add")),1)]),c,(0,s._)("div",{class:"operate-box activate-Pf",onClick:e[1]||(e[1]=(...t)=>g.activatePf&&g.activatePf(...t))},[(0,s.Wm)(x,{class:"pfIcon",icon:"RightOne",size:"2.5rem"}),u,(0,s._)("span",null,(0,o.zw)(t.$t("profile.activate")),1)]),d,(0,s._)("div",{class:"operate-box edit-pf",onClick:e[2]||(e[2]=(...t)=>g.editPf&&g.editPf(...t))},[(0,s.Wm)(x,{class:"pfIcon",icon:"EditTwo",size:"2.5rem"}),h,(0,s._)("span",null,(0,o.zw)(t.$t("profile.editor")),1)]),m,(0,s._)("div",{class:"operate-box delete-box",onClick:e[3]||(e[3]=(...t)=>g.delPf&&g.delPf(...t))},[(0,s.Wm)(x,{class:"pfIcon",icon:"TrashOne",size:"2.5rem"}),p,(0,s._)("span",null,(0,o.zw)(t.$t("profile.delete")),1)])]),(0,s._)("div",f,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(w.pfList.length,(t=>((0,s.wg)(),(0,s.iD)("div",{key:t,class:"profile-item",onClick:e=>g.selectFile(t-1)},[(0,s.Wm)(x,{class:(0,o.C_)({"file-static-icon":!0,"file-active-icon":w.active_item==t-1}),icon:w.active_item==t-1?"ActiveJob":"StaticJob",size:"10.5rem"},null,8,["class","icon"]),(0,s._)("span",{class:(0,o.C_)({"pf-static-num":!0,"pf-active-num":w.active_item==t-1})},(0,o.zw)(g.getPfNum(t)),3),(0,s._)("span",_,(0,o.zw)(w.pfList[t-1]["name"]),1)],8,b)))),128)),(0,s._)("div",v,[(0,s.Wm)($,{module:w.module,onClick:g.addPf,class:"file-static-icon",borderRadius:"0","use-icon":!0,icon:"AddTwo",bgcColor:"transparent",iconSize:"2.5rem"},null,8,["module","onClick"])])])])}var g=i(3185),x=i(84965),$=i(32015),J=i(49963),N=i(92797);const y={key:0,class:"mask"},k={class:"program-box"},P={class:"program-title-line"},j={class:"program-title-msg"},L={class:"program-pset-line"},C={class:"program-copy-text"},I={class:"program-pset-input"},z={class:"program-mode-line"},E={class:"program-copy-text"},D={class:"program-name-line"},W={class:"program-copy-text"},Z={class:"program-operate-line"};function S(t,e,i,a,n,r){const l=(0,s.up)("svgloader"),c=(0,s.up)("Counter"),u=(0,s.up)("InputText");return n.isShow?((0,s.wg)(),(0,s.iD)("div",y,[(0,s._)("div",k,[(0,s._)("div",P,[(0,s._)("span",j,(0,o.zw)(t.$t("newpro.newpro")),1),(0,s._)("span",{class:"program-box-close",onClick:e[0]||(e[0]=(...t)=>r.cancel&&r.cancel(...t))},[(0,s.Wm)(l,{class:"icon-close",icon:"Close",size:"1.2rem"})])]),(0,s._)("div",L,[(0,s._)("div",C,(0,o.zw)(t.$t("newpro.jobId")),1),(0,s._)("div",I,[(0,s.Wm)(c,{_width:"100%",cnum:n.newJobId.text,_min:1,_max:999999999,onUpdate:e[1]||(e[1]=t=>r.updateNewJob(t)),_ftszie:"2rem",textValid:r.checkJob(),validReason:"$t('newpro.repeatJob')"},null,8,["cnum","textValid"])])]),(0,s._)("div",z,[(0,s._)("div",E,(0,o.zw)(t.$t("newpro.jobName")),1),(0,s.Wm)(u,{text:n.newJobName.text,placeholder:t.$t("newpro.inputJobName"),class:"program-name-input",modelValue:n.newJobName,"onUpdate:modelValue":e[2]||(e[2]=t=>n.newJobName=t),textValid:r.checkJobName(),validReason:r.nameError},null,8,["text","placeholder","modelValue","textValid","validReason"])]),(0,s._)("div",D,[(0,s._)("div",W,(0,o.zw)(t.$t("newpro.des")),1),(0,s.Wm)(u,{text:n.newJobDesc.text,placeholder:t.$t("newpro.inputJobDes"),class:"program-name-input",modelValue:n.newJobDesc,"onUpdate:modelValue":e[3]||(e[3]=t=>n.newJobDesc=t)},null,8,["text","placeholder","modelValue"])]),(0,s._)("div",Z,[(0,s._)("div",{class:"program-cancel-btn",onClick:e[4]||(e[4]=(...t)=>r.cancel&&r.cancel(...t))},(0,o.zw)(t.$t("newpro.cancel")),1),(0,s._)("div",{class:"program-cnfrm-btn",onClick:e[5]||(e[5]=(...t)=>r.sbmtNewPrgrmData&&r.sbmtNewPrgrmData(...t))},(0,o.zw)(t.$t("newpro.confirm")),1)])])])):(0,s.kq)("",!0)}var V=i(23263),F=i(73496),T=i(89555),B=i(22805),A={components:{svgloader:F.Z,InputText:V.Z,Counter:T.Z},data(){return{isShow:!0,curMode:2,Profile:void 0,box:void 0,newJobName:{text:"",valid:!1},newJobId:{text:1,valid:!1},newJobDesc:{text:"",valid:!1}}},props:{pfList:{type:Array,default:function(){return[]}}},methods:{sbmtNewPrgrmData(){if(!this.checkJobName()||!this.checkJob())return;this.isShow=!1,this.Profile=(0,B.mK)(this.curMode),this.Profile.Name=this.newJobName.text,this.Profile.JobId=this.newJobId.text,this.Profile.Descr=this.newJobDesc.text;let t=this.newJobId.text;this.onConfirm&&this.onConfirm({Profile:{Profile:this.Profile},job:t})},cancel(){this.isShow=!1;let t=this.$t("dlgprogram.userCancel");this.onCancel&&this.onCancel(t)},closeboard(t){let e=t.clientX,i=t.clientY,s=this,o=s.box.offsetLeft-s.box.offsetWidth/2,a=s.box.offsetLeft+s.box.offsetWidth-s.box.offsetWidth/2,n=s.box.offsetTop,r=s.box.offsetTop+s.box.offsetHeight;e*i!=0&&(e<=o||e>=a||i>=r||i<=n)&&(window.removeEventListener("click",this.closeboard),s.isShow=!1)},getBox(){this.box=document.getElementsByClassName("program-box")[0]},updateNewJob(t){this.newJobId.text=t},checkJobName(){for(let t of this.pfList)if(t.name===this.newJobName.text)return!1;return!0},checkJob(){for(let t of this.pfList)if(t.job===this.newJobId.text||""===this.newJobId.text||this.newJobId.text>255)return!1;return!0},initDefaultProfile(){this.setJobId(),this.setJobName()},setJobId(){if(!this.checkJob()){this.newJobId.text=1;for(let t in this.pfList){if(this.pfList[t].job!==this.newJobId.text)break;this.newJobId.text=this.newJobId.text+1}}},setJobName(){0!=this.checkJobName()&&(this.newJobName.text=`job${this.newJobId.text}`)}},computed:{nameError(){return""==this.newJobName.text?this.$t("dlgprogram.nameNotEmpty"):this.$t("dlgprogram.nameRepeat")}},watch:{pfList:{immediate:!0,deep:!0,handler:function(){this.initDefaultProfile()}}},mounted(){setTimeout((()=>{this.getBox(),window.addEventListener("click",this.closeboard)}),50)}},q=i(83744);const O=(0,q.Z)(A,[["render",S],["__scopeId","data-v-1348ac0a"]]);var R=O;const M=t=>new Promise(((e,i)=>{let s=(0,J.ri)(R,t).use(N.Z).mount(document.createElement("div"));document.body.appendChild(s.$el),s.onConfirm=t=>{e(t)},s.onCancel=function(t){i(t)}}));var U=M;const Y={components:{},data(){return{module:"JOB",pstmodule:"SELJOB",pfList:[],active_item:-1}},methods:{getPfNum(t){let e=this.pfList[t-1].job;return e<10?`0${e}`:`${e}`},delPf(){if(-1==this.active_item)return void x.c.error([this.$t("promsg.nselect_file")]);let t=this.pfList[this.active_item].job;if(t==this.activateJob){let t=this.$t("promsg.no_delete");return void x.c.warning([t])}let e=`${this.$t("promsg.is_del")}${this.pfList[this.active_item].job}`;this.$route.path.startsWith("/profile")&&this.$route.query&&this.$route.query.job==t&&(e=this.$t("promsg.deleteFileEditing")),(0,$.Z)({title:this.$t("promsg.del"),confirmText:this.$t("promsg.yes"),cancelText:this.$t("promsg.no"),msg:e}).then((()=>{(0,g.I0)({job:this.pfList[this.active_item].job}).then((e=>{this.$bus.emit("delJob",{job:t}),9130!=e.status?9125!=e.status?0==e.status?(this.$route.path.startsWith("/profile")&&this.$route.query&&this.$route.query.job==t&&this.$router.push({path:this.$route.path,query:{job:-1}}),this.operateFile({action:"sub"}),x.c.success([this.$t("promsg.del_suc")])):x.c.warning([this.$t("promsg.nexit"),this.$t("promsg.has_del")]):x.c.warning(["文件不存在或已经删除"]):x.c.error(["删除失败"])})).catch((()=>{x.c.error(["删除失败"]),this.operateFile({action:"sub"})})),this.active_item=-1}))},addPf(){U({pfList:this.pfList}).then((t=>{let e=t.job;(0,g.i)(t.Profile).then((t=>{9121!=t.status?9123!=t.status?(0==t.status?this.$router.push({path:"/profile/job",query:{job:e}}):x.c.error([this.$t("promsg.add_fail")]),this.operateFile({action:"add"})):x.c.warning(["文件写入数据库失败"]):x.c.warning(["Pset或文件名重复"])})).catch((()=>{x.c.error([this.$t("promsg.add_fail")]),this.operateFile({action:"add"})}))}))},sortBy(t){return function(e,i){return e[t]-i[t]}},editPf(){if(-1==this.active_item)return void x.c.error([this.$t("promsg.nselect_file")]);let t=this.pfList[this.active_item];this.$router.push({path:"/profile/job",query:{job:t.job}}),this.operateFile({action:"edit"})},activatePf(){if(1!=this.$store.state.g_status.psetsrc){let t=this.$t("promsg.msgOne"),e=this.$t("promsg.msgTwo");return void x.c.warning([t,e])}if(-1==this.active_item)return void x.c.error([this.$t("promsg.nselect_file")]);if(this.pfList[this.active_item].pset==this.$store.state.g_status.pset)return void x.c.warning([this.$t("promsg.file_locate")]);if(this.$store.state.g_status.busy)return void x.c.warning([this.$t("promsg.run_status"),this.$t("promsg.nactivate_file")]);let t=this.pfList[this.active_item].job;(0,g.v3)(t).then((t=>{9126!=t.status&&9129!=t.status?(0==t.status?x.c.success([this.$t("promsg.activate_suc")]):x.c.error("激活失败!"),this.operateFile({action:"activate"})):x.c.warning(["下位机切换文件失败"])})).catch((()=>{x.c.error([this.$t("promsg.activate_fail")]),this.operateFile({action:"activate"})}))},selectFile(t){this.active_item=t==this.active_item?-1:t},updateActiveItem(){let t=-1;for(let e=0;e<this.pfList.length;e++)if(this.pfList[e].job==this.activateJob){t=e;break}this.active_item=t},getPfList(t){(0,g.Lk)().then((e=>{9127!=e.status&&0==e.status?(this.pfList=e.data.sort(this.sortBy("job")),this.updateActiveItem(),t&&t()):this.pfList=[]})).catch((()=>{this.pfList=[]}))},operateFile(t){switch(t.action){case"add":this.showprofile_lst=!1,this.getPfList();break;case"sub":this.getPfList();break;case"edit":this.showprofile_lst=!1;break;case"close":this.showprofile_lst=!1;break}}},props:{fileItems:{type:Array,default:function(){return[]}}},watch:{fileItems:{immediate:!0,deep:!0,handler:function(){this.pfList=this.fileItems,this.pfList.sort(this.sortBy("pset"))}}},created(){this.getPfList()},unmounted(){},computed:{notAllowActivate(){return 1!=this.$store.state.g_status.psetsrc},activateJob(){return this.$store.state.g_status.job},enabled(){return this.module in this.$store.state.f_status.permissions&&4==this.$store.state.f_status.permissions[this.module]},pointerEvent(){return this.enabled?"auto":"none"},opacity(){return this.enabled?1:.3},actEnable(){return this.pstmodule in this.$store.state.f_status.permissions&&4==this.$store.state.f_status.permissions[this.pstmodule]},actPointerEvent(){return this.actEnable?"auto":"none"},actOpacity(){return this.actEnable?1:.3},jobfileEnable(){return 4==this.$store.state.f_status.permissions[this.module]||4==this.$store.state.f_status.permissions[this.pstmodule]},jobfilePointerEvent(){return this.jobfileEnable?"auto":"none"},jobfileOpacity(){return this.jobfileEnable?1:.3}}},H=()=>{(0,J.sj)((t=>({"14e63eb2":t.actPointerEvent,d2618ad4:t.actOpacity,e42d7acc:t.pointerEvent,e8b934a4:t.opacity})))},K=Y.setup;Y.setup=K?(t,e)=>(H(),K(t,e)):H;var X=Y;const G=(0,q.Z)(X,[["render",w],["__scopeId","data-v-86519fee"]]);var Q=G}}]);
//# sourceMappingURL=511.bbef99ca.js.map