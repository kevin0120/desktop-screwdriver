"use strict";(self["webpackChunkleetx_web"]=self["webpackChunkleetx_web"]||[]).push([[320],{39496:function(t,e,i){i.d(e,{QO:function(){return d},Y6:function(){return o},cx:function(){return r},fm:function(){return u},j$:function(){return n},me:function(){return l},oN:function(){return a}});var s=i(11586);function a(){return(0,s.Z)({url:"dev/calibrate/sensor/kb",method:"get"})}function l(){return(0,s.Z)({url:"dev/calibrate/sensor/result",method:"get"})}function r(t){return(0,s.Z)({url:"dev/calibrate/sensor/set",method:"post",data:t})}function n(){return(0,s.Z)({url:"dev/calibrate/fac",method:"get"})}function o(){return(0,s.Z)({url:"dev/calibrate/pro",method:"get"})}function d(){return(0,s.Z)({url:"dev/calibrate/exit",method:"get"})}function u(){return(0,s.Z)({url:"dev/calibrate/enable",method:"get"})}},89555:function(t,e,i){i.d(e,{Z:function(){return p}});var s=i(66252),a=i(3577),l=i(49963);const r=["id"],n={class:"val-box"},o={class:"num"};function d(t,e,i,d,u,c){return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)({"counter-box":!0,"valid-text":!i.textValid}),id:u.cid},[(0,s._)("div",{class:"sub-box",onClick:e[0]||(e[0]=(...t)=>c.subNum&&c.subNum(...t))},[(0,s._)("span",{class:(0,a.C_)(["sub-btn",{forbit:u.num==u.min}])},"-",2)]),(0,s._)("div",n,[(0,s._)("span",o,(0,a.zw)(u.num),1)]),(0,s._)("div",{class:"add-box",onClick:e[1]||(e[1]=(...t)=>c.addNum&&c.addNum(...t))},[(0,s._)("span",{class:(0,a.C_)(["add-btn",{forbit:u.num==u.max}])},"+",2)]),(0,s.wy)((0,s._)("span",{class:"valid-reason"},(0,a.zw)(i.validReason),513),[[l.F8,!i.textValid]])],10,r)}const u={data(){return{num:0,cid:Math.random(),max:0,min:0}},props:{cnum:{type:Number,default:0},_width:{type:String,default:"7.5rem"},_bWidth:{type:String,default:"1.7625rem"},_height:{type:String,default:"3.1431rem"},_ftszie:{type:String,default:"1.5rem"},_min:{type:Number,default:-9999},_max:{type:Number,default:9999},_value:{type:Number,default:1},textValid:{type:Boolean,default:!0},validReason:{type:String,default:"数据不合法"}},methods:{subNum(){this.num=Math.floor(this.num>this._min?this.num-this._value:this._min),this.$emit("update",this.num)},addNum(){Math.floor(this.num=this.num<this._max?this.num+this._value:this._max),this.$emit("update",this.num)},initNum(){this.max=this._max,this.min=this._min,this.num=Math.floor(this.cnum>=this.min&&this.cnum<=this.max?this.cnum:this.min),this.$emit("update",this.num)}},watch:{cnum:{handler:function(){this.initNum()}},_max:{deep:!0,handler:function(){this.initNum()}},_min:{deep:!0,handler:function(){this.initNum()}}},created(){this.initNum()}},c=()=>{(0,l.sj)((t=>({"0c347b10":t._height,"29ed0e55":t._width,"1157763c":t._ftszie})))},h=u.setup;u.setup=h?(t,e)=>(c(),h(t,e)):c;var m=u,b=i(83744);const g=(0,b.Z)(m,[["render",d],["__scopeId","data-v-a7278d4e"]]);var p=g},52320:function(t,e,i){i.r(e),i.d(e,{default:function(){return G}});var s=i(66252),a=i(3577);const l=t=>((0,s.dD)("data-v-45e4eb82"),t=t(),(0,s.Cn)(),t),r={class:"tech-dmrct"},n={class:"select-program-line"},o={class:"select-program-text"},d={class:"is-calibration"},u={class:"serial-line"},c={class:"serial-text"},h={class:"device-text"},m={class:"device-input"},b={class:"demarcate-val"},g={class:"mask-box"},p=l((()=>(0,s._)("td",{class:"delBox"},null,-1))),f={class:"table-box"},_={class:"demarcate-table"},v={class:"delBox"},C={class:"cacl-line"},x={class:"calc-res"};function w(t,e,i,l,w,$){const k=(0,s.up)("NewSelect"),y=(0,s.up)("LeetxSwitch"),S=(0,s.up)("Counter"),N=(0,s.up)("InputVal"),V=(0,s.up)("LeetxButton");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",n,[(0,s._)("span",o,(0,a.zw)(t.$t("dbgdmrct.programselect")),1),(0,s.Wm)(k,{isScroll:!0,module:w.module,isAllowChng:!$.isBusy,width:15,height:2.4,realVal:$.defaultPset,options:w.pros,isReturnKey:!1,class:"select",onValChng:e[0]||(e[0]=t=>$.valChng(t))},null,8,["module","isAllowChng","height","realVal","options"])]),(0,s._)("div",null,[(0,s._)("span",d,(0,a.zw)(t.$t("dbgdmrct.isCalibration")),1),(0,s.Wm)(y,{module:w.module,value:w.isCalibrated,activeVal:!0,staticVal:!1,height:2,class:"is-calibration-btn",modelValue:w.isCalibrated,"onUpdate:modelValue":e[1]||(e[1]=t=>w.isCalibrated=t)},null,8,["module","value","modelValue"])]),(0,s._)("div",u,[(0,s._)("span",c,(0,a.zw)(t.$t("dbgdmrct.serialnumber")),1),(0,s.Wm)(S,{cnum:w.nthGroup,_min:0,_max:$.maxGroup,_height:"2.5rem",onUpdate:e[2]||(e[2]=t=>w.nthGroup=t),class:"serial-counter"},null,8,["cnum","_max"]),(0,s._)("span",h,(0,a.zw)(t.$t("dbgdmrct.torquevalue")),1),(0,s._)("span",m,(0,a.zw)(w.devVal),1),(0,s._)("span",b,(0,a.zw)(t.$t("dbgdmrct.referencevalue")),1),(0,s.Wm)(N,{module:w.module,sensorValue:w.calibrationVal,editable:w.editable,class:"demarcate-input",width:"12.5vw",height:"3.125vh",onUpdateData:e[3]||(e[3]=t=>$.updateData(t))},null,8,["module","sensorValue","editable"]),(0,s.Wm)(V,{class:"add",module:w.module,bgcColor:"transparent",width:"2rem",height:"2rem",borderRadius:"0",useIcon:!0,icon:"AddDmrct",iconSize:"2.5rem",onClick:$.addToArr},null,8,["module","onClick"]),(0,s.Wm)(V,{module:w.module,class:"del-icon",bgcColor:"transparent",width:"2rem",height:"2rem",useIcon:!0,icon:"DeleteAll",iconSize:"2.5rem",onClick:$.delFromArrAll},null,8,["module","onClick"])]),(0,s._)("div",g,[(0,s._)("tr",null,[(0,s._)("td",null,(0,a.zw)(t.$t("dbgdmrct.serialnumber")),1),(0,s._)("td",null,(0,a.zw)(t.$t("dbgdmrct.torquevalue")),1),(0,s._)("td",null,(0,a.zw)(t.$t("dbgdmrct.referencevalue")),1),p]),(0,s._)("div",f,[(0,s._)("table",_,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(w.inputs.length,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t},[(0,s._)("td",null,(0,a.zw)(t),1),(0,s._)("td",null,(0,a.zw)(w.devs[t-1]),1),(0,s._)("td",null,(0,a.zw)(w.inputs[t-1]),1),(0,s._)("td",v,[(0,s.Wm)(V,{class:"delOne",module:w.module,bgcColor:"transparent",width:"2rem",height:"2rem",borderRadius:"0",useIcon:!0,icon:"DelDmrct",iconSize:"2rem",onClick:e=>$.delFromArr(t)},null,8,["module","onClick"])])])))),128))])])]),(0,s._)("div",C,[(0,s.Wm)(V,{module:w.module,class:"btn",textColor:"#fff",borderRadius:"4px",bgcColor:"#00c155",width:"17.25vw",height:"3.9063vh",fontSize:"1.625rem",fontFamily:"--SHSC-M",text:t.$t("dbgdmrct.calculate"),onClick:$.calculate},null,8,["module","text","onClick"]),(0,s._)("span",x,(0,a.zw)(t.$t("dbgdmrct.techSensitivity"))+"："+(0,a.zw)(w.k),1)]),(0,s.Wm)(V,{class:"confirm-box",module:w.module,textColor:"#fff",borderRadius:"4px",bgcColor:"#00c155",width:"30.125rem",height:"3.75rem",fontSize:"2.25rem",fontFamily:"--SHSC-B",text:t.$t("dbgdmrct.save"),onClick:$.submitCalibrateData},null,8,["module","text","onClick"])])}var $=i(70032),k=i(89555),y=i(16496),S=i(39496),N=i(84965),V=i(74125),F=i(265),z=i(57414),D=i(92797),Z={components:{NewSelect:y.Z,LeetxButton:F.Z,Counter:k.Z,InputVal:$.Z},data(){return{calibrateData:{},gain:0,offset:0,devs:[],inputs:[],files:[],pros:{},res:{ret_sensor:.001,ret_pos:.002},nthGroup:0,k:1,b:0,module:"CALIBRATION",times:0,devVal:0,calibrationVal:0,editable:!1,isCalibrated:!1,global_k:"",global_isCalibrated:""}},methods:{getRes(){(0,S.oN)().then((t=>{0==t.status?(this.k=t.data.calib_k,this.b=t.data.calib_offset):N.c.error([this.$t("dbgdmrct.failedGetCalibrationData")])})).catch((()=>{N.c.error([this.$t("dbgdmrct.failedGetCalibrationData")])}))},enterProPage(){(0,S.Y6)().then((t=>{0!=t.status?N.c.warning([this.$t("dbgdmrct.entryCalibrationFail")]):(0,S.fm)().then((t=>{this.isCalibrated=t.data.calibrate_enable,this.k=t.data.calibrate_k,this.global_isCalibrated=JSON.stringify(this.isCalibrated),this.global_k=JSON.stringify(this.k)})).catch((()=>{N.c.warning([this.$t("dbgdmrct.enableProcessCalibrationFail")])}))})).catch((()=>{N.c.warning([this.$t("dbgdmrct.entryCalibrationFail")])}))},leaveProPage(){(0,S.QO)().then((t=>{0!=t.status&&N.c.warning([this.$t("dbgdmrct.exitFail")])})).catch((()=>{N.c.warning([this.$t("dbgdmrct.exitFail")])}))},getAllProfiles(){(0,V.Lm)().then((t=>{if(0==t.status){this.files=t.data,this.pfList=this.files.sort(this.sortBy("pset"));for(let t=0;t<this.files.length;t++)this.pros[`${this.files[t].pset} [${this.files[t].name}]`]=this.files[t].pset}}))},valChng(t){if(1==this.$store.state.g_status.psetsrc)void 0!=t&&(0,V.TU)(t).then((()=>{N.c.success([this.$t("promsg.activate_suc")]),(0,S.fm)().then((t=>{this.isCalibrated=t.data.calibrate_enable,this.global_isCalibrated=JSON.stringify(this.isCalibrated),this.k=t.data.calibrate_k,0!=t.status&&N.c.warning([this.$t("dbgdmrct.enableProcessCalibrationFail")])})).catch((()=>{N.c.warning([this.$t("dbgdmrct.enableProcessCalibrationFail")])}))})).catch((()=>{N.c.error([this.$t("promsg.activate_fail")])}));else{let t=this.$t("promsg.msgOne"),e=this.$t("promsg.msgTwo");N.c.warning([t,e])}},clbck(){N.c.warning([this.$t("promsg.run_status"),this.$t("promsg.nactivate_file")])},sortBy(t){return function(e,i){return e[t]-i[t]}},updateData(t){this.calibrationVal=t.sensorValue},addToArr(){let t=parseFloat(this.devVal.toFixed(3)),e=parseFloat(this.calibrationVal.toFixed(3));if("0"==t)return N.c.warning([this.$t("dbgdmrct.notBeZero")]);this.devs.splice(this.nthGroup,0,t),this.inputs.splice(this.nthGroup,0,e),this.nthGroup+=1},delFromArr(t){0!=this.nthGroup&&(this.devs.splice(t-1,1),this.inputs.splice(t-1,1),this.nthGroup=this.nthGroup>this.inputs.length-1?this.inputs.length:this.nthGroup)},delFromArrAll(){if(0==this.devs.length&&0==this.inputs.length)return;let t=this.$t("dbgdmrct.deleteConfigurate"),e=this.$t("dbgdmrct.yes"),i=this.$t("dbgdmrct.no"),s=this.$t("dbgdmrct.deleteAll");(0,z.Z)({title:t,confirmText:e,cancelText:i,msg:s}).then((()=>{this.devs=[],this.inputs=[],this.nthGroup=0}))},calculate(){(0,S.oN)().then((t=>{if(0==t.status){if(this.k=t.data.calib_k,this.b=t.data.calib_offset,this.devs.length!=this.inputs.length||0==this.devs.length)return;let e=0;for(let t=0;t<this.inputs.length;t++){let i=this.inputs[t]-this.b,s=this.devs[t]-this.b,a=i/s;e+=a/this.inputs.length}this.k=parseFloat(e).toFixed(5)}})).catch((()=>{N.c.error([this.$t("dbgdmrct.failRead")])}))},submitCalibrateData(){const t=this.k,e=this.b,i=this.isCalibrated;this.global_k=JSON.stringify(t),this.global_isCalibrated=JSON.stringify(this.isCalibrated),(0,S.cx)({calib_k:t,calib_offset:e,calibrate_enable:i}).then((t=>{if(0==t.status){let t=D.Z.global.t("global.success");N.c.success([t])}else N.c.error([this.$t("dbgdmrct.setupFail")])})).catch((()=>{N.c.error([this.$t("dbgdmrct.setupFail")])}))},getDevVal(){(0,S.me)().then((t=>{this.devVal=parseFloat(t.data.inner_maxval.toFixed(3)),t.data.has_ext?this.calibrationVal=t.data.ext_maxval:this.editable=!0}))}},beforeRouteLeave(t,e,i){let s=this.global_k==JSON.stringify(this.k),a=this.global_isCalibrated==JSON.stringify(this.isCalibrated);if(s&&a)i();else{let t=this.$t("setcontrol.saveSet"),e=this.$t("setcontrol.yes"),s=this.$t("setcontrol.no"),a=this.$t("setcontrol.isSaveSet");(0,z.Z)({title:t,confirmText:e,cancelText:s,msg:a}).then((()=>{this.submitCalibrateData(),i()})).catch((()=>{i()}))}},mounted(){this.enable&&this.enterProPage(),this.getDevVal()},unmounted(){this.enable&&this.leaveProPage()},created(){this.global_k=JSON.stringify(this.k),this.global_isCalibrated=JSON.stringify(this.isCalibrated),this.getAllProfiles()},computed:{isBusy(){return this.$store.state.g_status.busy},runOk(){return this.$store.state.g_status["rok"]},torque(){return parseFloat(this.res.ret_sensor.toFixed(3))},maxGroup(){return this.inputs.length},defaultPset(){return this.$store.state.g_status["pset"]},enable(){return this.module in this.$store.state.f_status.permissions&&4==this.$store.state.f_status.permissions[this.module]}},watch:{runOk:{handler(){this.runOk&&this.enable&&this.getDevVal()}}}},A=i(83744);const O=(0,A.Z)(Z,[["render",w],["__scopeId","data-v-45e4eb82"]]);var G=O}}]);
//# sourceMappingURL=320.9e8ba27f.js.map